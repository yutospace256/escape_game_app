<!DOCTYPE html>
<html lang="ja">
<head>
  <title>GAME HOME</title>
  <style>
    #progress-bar {
      height: 20px; /* Adjust height as desired */
      width: 0; /* Initially zero width */
      background-color: #007bff; /* Adjust color as desired */
      transition: width 1s ease-in-out; /* Add smooth transition */
      border: 1px solid #ccc;
      border-radius: 5px; /* Add rounded corners */
    }
    
    #progress-container {
      width: 100%; /* Full width of the parent */
      background-color: #ddd;
      border-radius: 5px; /* Match the progress bar's corners */
    }
  </style>
</head>
<body>
  <header>
    <h1>GAME HOME</h1>
  </header>
  <div id="progress-container">
    <div id="progress-bar"></div>
  </div>
  <a>Mission Code</a>
  <p id="user-id">{{ user_id }}</p> <!-- Added id attribute -->
  <form method="POST">
    <input type="text" name="mission_code" placeholder="Mission Code" required>
    <input type="hidden" name="missioncode">
    <input type="submit" value="Next">
  </form>
  <p id="time-display"></p>  

  <!-- Pass end_time variable from Python -->
  <input type="hidden" id="end-time" value="{{ end_time }}">

  <script>
    var endTimeTimestamp = parseInt(document.getElementById('end-time').value);
    console.log("End Time Timestamp: ", endTimeTimestamp); // Log end time timestamp
    var endTime = new Date(endTimeTimestamp); // Parse end_time from hidden input as a date object
    console.log("Parsed End Time: ", endTime); // Log parsed end time
    var timeDisplay = document.getElementById('time-display'); 
    var progressBar = document.getElementById('progress-bar');

    function updateTime() {
      var currentTime = new Date();
      console.log("Current Time: ", currentTime); // Log current time
      var remainingTime = endTime.getTime() - currentTime.getTime();
      console.log("Remaining Time: ", remainingTime); // Log remaining time

      // Check if remaining time is within 5 minutes
      if (remainingTime > 0 && remainingTime <= 5 * 60 * 1000) {
        // Calculate percentage of remaining time (within 5 minutes)
        var totalTime = 5 * 60 * 1000; // 5 minutes in milliseconds
        var progress = Math.min(remainingTime, totalTime) / totalTime * 100;
        console.log("Progress: ", progress); // Log progress
        progressBar.style.width = progress + '%';  // Update width based on progress
        timeDisplay.textContent = Math.floor(remainingTime / 1000) + 's';  // Display remaining seconds
      } else if (remainingTime <= 0) {
        progressBar.style.width = '0%'; // Set to 0% if time has expired
        timeDisplay.textContent = 'Time is up!';
        clearInterval(timerInterval); // Stop the interval
      } else {
        progressBar.style.width = '100%'; // Set to 100% if game hasn't started
        timeDisplay.textContent = 'Waiting for game start...';
      }
    }

    var timerInterval;

    window.onload = function() {
      updateTime(); // Call update function on page load
      timerInterval = setInterval(updateTime, 1000); // Update time every second
    };
  </script>
</body>
</html>
